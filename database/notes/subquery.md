# ðŸ§¬ SQL ì„œë¸Œì¿¼ë¦¬(Subquery)

**ì„œë¸Œì¿¼ë¦¬(Subquery)** ëŠ” SQLë¬¸ ì•ˆì— **í¬í•¨ëœ ë˜ ë‹¤ë¥¸ SELECT ë¬¸**ìž…ë‹ˆë‹¤.  
ì£¼ ì¿¼ë¦¬(Main Query)ë¥¼ ë³´ì¡°í•˜ë©°, **í•„í„°ë§, ë¹„êµ, ê°’ ê³„ì‚°, ì§‘í•© ì¡°ê±´** ë“±ì— ìžì£¼ ì‚¬ìš©ë©ë‹ˆë‹¤.

---

## 1ï¸âƒ£ ì„œë¸Œì¿¼ë¦¬ëž€?

SQL ë¬¸ ë‚´ì— í¬í•¨ëœ **ì¤‘ì²©ëœ SELECT ë¬¸**, ì£¼ë¡œ `WHERE`, `FROM`, `SELECT` ì ˆ ì•ˆì—ì„œ ì‚¬ìš©ë¨

âœ” ê²°ê³¼ë¥¼ ë‹¨ì¼ ê°’, ë¦¬ìŠ¤íŠ¸, í…Œì´ë¸” í˜•íƒœë¡œ ë°˜í™˜  
âœ” SELECT, INSERT, UPDATE, DELETE ë¬¸ ì–´ë””ì„œë“  ì‚¬ìš© ê°€ëŠ¥

---

## 2ï¸âƒ£ ì„œë¸Œì¿¼ë¦¬ ìœ„ì¹˜ë³„ ë¶„ë¥˜

| ìœ í˜• | ìœ„ì¹˜ | ì„¤ëª… |
|------|------|------|
| **ìŠ¤ì¹¼ë¼ ì„œë¸Œì¿¼ë¦¬** | `SELECT` | ë‹¨ì¼ ê°’ ë°˜í™˜ |
| **ì¸ë¼ì¸ ë·°** | `FROM` | ìž„ì‹œ í…Œì´ë¸”ë¡œ ì‚¬ìš© |
| **ì„œë¸Œì¿¼ë¦¬ in WHERE** | `WHERE` | ì¡°ê±´ì‹ ì•ˆì—ì„œ ì‚¬ìš© |
| **EXISTS ì„œë¸Œì¿¼ë¦¬** | `WHERE EXISTS` | ì¡´ìž¬ ì—¬ë¶€ ê²€ì‚¬ |
| **ìƒê´€ ì„œë¸Œì¿¼ë¦¬** | `WHERE`, `SELECT` | ì™¸ë¶€ ì¿¼ë¦¬ì™€ ì—°ê´€ëœ ê°’ ì‚¬ìš© |

---

## 3ï¸âƒ£ ìŠ¤ì¹¼ë¼ ì„œë¸Œì¿¼ë¦¬ (SELECT ì ˆ ë‚´ë¶€)

```sql
SELECT name,
  (SELECT COUNT(*) FROM orders WHERE user_id = users.id) AS order_count
FROM users;
```

âœ” ì‚¬ìš©ìžë³„ ì£¼ë¬¸ ìˆ˜ë¥¼ í•¨ê»˜ ì¡°íšŒ  
âœ” ì„œë¸Œì¿¼ë¦¬ê°€ ë‹¨ì¼ ê°’ì„ ë°˜í™˜ (ìŠ¤ì¹¼ë¼ ê°’)

---

## 4ï¸âƒ£ WHERE ì ˆì—ì„œ ì‚¬ìš©í•˜ëŠ” ì„œë¸Œì¿¼ë¦¬

```sql
SELECT name FROM users
WHERE id IN (SELECT user_id FROM orders WHERE item = 'Book');
```

âœ” ì£¼ë¬¸í•œ ì•„ì´í…œì´ "Book"ì¸ ì‚¬ìš©ìžë§Œ ì¡°íšŒ  
âœ” `IN`, `=`, `>`, `<` ë“±ê³¼ í•¨ê»˜ ìžì£¼ ì‚¬ìš©ë¨

---

## 5ï¸âƒ£ IN vs EXISTS

### 1) `IN` ì‚¬ìš©

```sql
SELECT name FROM users
WHERE id IN (SELECT user_id FROM orders);
```

---

### 2) `EXISTS` ì‚¬ìš©

```sql
SELECT name FROM users u
WHERE EXISTS (
  SELECT 1 FROM orders o WHERE o.user_id = u.id
);
```

---

### 3) `IN` ê³¼ `EXISTS` ë¹„êµ

| ë¹„êµ í•­ëª© | IN | EXISTS |
|-----------|----|--------|
| ì²˜ë¦¬ ë°©ì‹ | ê²°ê³¼ ì§‘í•© ë¹„êµ | ì¡´ìž¬ ì—¬ë¶€ë§Œ í™•ì¸ |
| ì„œë¸Œì¿¼ë¦¬ ê²°ê³¼ | ëª…ì‹œì  ë¹„êµ ëŒ€ìƒ | TRUE/FALSE ë°˜í™˜ |
| ì„±ëŠ¥ | ìž‘ì€ ì„œë¸Œì¿¼ë¦¬ì¼ ë• IN | í° ë°ì´í„°ì…‹ì€ EXISTS íš¨ìœ¨ì  |

---

## 6ï¸âƒ£ ìƒê´€ ì„œë¸Œì¿¼ë¦¬ (ì™¸ë¶€ ì¿¼ë¦¬ ì°¸ì¡°)

```sql
SELECT name FROM users u
WHERE EXISTS (
  SELECT 1 FROM orders o WHERE o.user_id = u.id AND o.item = 'Pen'
);
```

âœ” ì„œë¸Œì¿¼ë¦¬ì—ì„œ **ì™¸ë¶€ ì¿¼ë¦¬ì˜ ì»¬ëŸ¼(u.id)** ë¥¼ ì°¸ì¡°í•¨  
âœ” ì™¸ë¶€ ì¿¼ë¦¬ì˜ ê° í–‰ë§ˆë‹¤ **ì„œë¸Œì¿¼ë¦¬ë¥¼ ë°˜ë³µ ìˆ˜í–‰**  
âœ” íš¨ìœ¨ì„± ì¸¡ë©´ì—ì„œ ì£¼ì˜ í•„ìš”

---

## 7ï¸âƒ£ FROM ì ˆì˜ ì„œë¸Œì¿¼ë¦¬ (ì¸ë¼ì¸ ë·°)

```sql
SELECT name, order_count
FROM (
  SELECT user_id, COUNT(*) AS order_count
  FROM orders
  GROUP BY user_id
) AS order_stats
JOIN users ON users.id = order_stats.user_id;
```

âœ” ì§‘ê³„ ê²°ê³¼ë¥¼ í•˜ë‚˜ì˜ **ìž„ì‹œ í…Œì´ë¸”**ì²˜ëŸ¼ JOINì— í™œìš©  
âœ” ì‹¤ë¬´ì—ì„œ **í†µê³„/ë¶„ì„ ì¿¼ë¦¬**ì— ìžì£¼ ì‚¬ìš©

---

## 8ï¸âƒ£ UPDATE / DELETEì—ì„œì˜ ì„œë¸Œì¿¼ë¦¬

```sql
-- íŠ¹ì • ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ì‚¬ìš©ìžë§Œ ì‚­ì œ
DELETE FROM users
WHERE id IN (SELECT user_id FROM orders WHERE item = 'Expired');

-- ì¡°ê±´ì— ë§žëŠ” ì£¼ë¬¸ ìƒíƒœ ì—…ë°ì´íŠ¸
UPDATE orders
SET status = 'archived'
WHERE user_id IN (SELECT id FROM users WHERE is_deleted = 1);
```

âœ” ì„œë¸Œì¿¼ë¦¬ëŠ” ì¡°íšŒë¿ ì•„ë‹ˆë¼ **ë°ì´í„° ìˆ˜ì •/ì‚­ì œ** ì¡°ê±´ì—ë„ í™œìš©ë¨

---

## 9ï¸âƒ£ ì„œë¸Œì¿¼ë¦¬ vs JOIN

| í•­ëª© | ì„œë¸Œì¿¼ë¦¬ | JOIN |
|------|----------|------|
| ì‚¬ìš© ëª©ì  | ê°’ ê¸°ë°˜ ì¡°ê±´, ì¡´ìž¬ ì—¬ë¶€ | ë‹¤ì¤‘ í…Œì´ë¸” ê²°í•© |
| ì„±ëŠ¥ | ë‹¨ìˆœ ì¿¼ë¦¬ì— ì í•© | ë³µìž¡í•œ ê´€ê³„ ì²˜ë¦¬ ìœ ë¦¬ |
| ê°€ë…ì„± | ì§§ê³  ë‹¨ìˆœ | ë³µìž¡í•œ ë¡œì§ì€ JOINì´ ëª…í™• |

---

## ðŸŽ¯ ì •ë¦¬

| êµ¬ë¶„ | ì„¤ëª… |
|------|------|
| ìŠ¤ì¹¼ë¼ ì„œë¸Œì¿¼ë¦¬ | SELECT ì ˆì—ì„œ ë‹¨ì¼ ê°’ ë°˜í™˜ |
| WHERE ì„œë¸Œì¿¼ë¦¬ | ì¡°ê±´ ë¹„êµì— ì‚¬ìš© (IN, EXISTS ë“±) |
| FROM ì„œë¸Œì¿¼ë¦¬ | ì¸ë¼ì¸ ë·° (ìž„ì‹œ í…Œì´ë¸”) |
| ìƒê´€ ì„œë¸Œì¿¼ë¦¬ | ì™¸ë¶€ ì¿¼ë¦¬ì˜ ì»¬ëŸ¼ì„ ì°¸ì¡° |
| EXISTS | ì¡´ìž¬ ì—¬ë¶€ íŒë‹¨ (TRUE/FALSE) |
| ì„±ëŠ¥ íŒ | ìž‘ì€ ì§‘í•© â†’ IN, í° ì§‘í•© â†’ EXISTS |
